<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Retention time correction based on alignment of house keeping peak
groups — adjustRtime-peakGroups • xcms</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Retention time correction based on alignment of house keeping peak
groups — adjustRtime-peakGroups"><meta property="og:description" content='This method performs retention time adjustment based on the
alignment of chromatographic peak groups present in all/most samples
(hence corresponding to house keeping compounds). First the retention
time deviation of these peak groups is described by fitting either a
polynomial (smooth = "loess") or a linear (
smooth = "linear") model to the data points. These models are
subsequently used to adjust the retention time of each spectrum in
each sample.
It is also possible to exclude certain samples within an experiment from
the estimation of the alignment models. The parameter subset
allows to define the indices of samples within object that should
be aligned. Samples not part of this subset are left out in the
estimation of the alignment models, but their retention times are
subsequently adjusted based on the alignment results of the closest sample
in subset (close in terms of position within the object).
Alignment could thus be performed on only real samples leaving out
e.g. blanks, which are then in turn adjusted based on the closest real
sample. Here it is up to the user to ensure that the samples within
object are ordered correctly (e.g. by injection index).
How the non-subset samples are adjusted bases also on the parameter
subsetAdjust: with subsetAdjust = "previous", each non-subset
sample is adjusted based on the closest previous subset sample which results
in most cases with adjusted retention times of the non-subset sample being
identical to the subset sample on which the adjustment bases. The second,
default, option is to use subsetAdjust = "average" in which case
each non subset sample is adjusted based on the average retention time
adjustment from the previous and following subset sample. For the average
a weighted mean is used with weights being the inverse of the distance of
the non-subset sample to the subset samples used for alignment.
See also section Alignment of experiments including blanks in the
xcms vignette for an example.
The PeakGroupsParam class allows to specify all
    settings for the retention time adjustment based on house keeping
    peak groups present in most samples.
    Instances should be created with the PeakGroupsParam constructor.
adjustRtimePeakGroups returns the features (peak groups)
which would, depending on the provided PeakGroupsParam, be
selected for alignment/retention time correction.
minFraction,minFraction&amp;lt;-: getter and setter
    for the minFraction slot of the object.
extraPeaks,extraPeaks&amp;lt;-: getter and setter
    for the extraPeaks slot of the object.
smooth,smooth&amp;lt;-: getter and setter
    for the smooth slot of the object.
span,span&amp;lt;-: getter and setter
    for the span slot of the object.
family,family&amp;lt;-: getter and setter
    for the family slot of the object.
peakGroupsMatrix,peakGroupsMatrix&amp;lt;-: getter and
    setter for the peakGroupsMatrix slot of the object.
subset,subset&amp;lt;-: getter and
    setter for the subset slot of the object.
subsetAdjust,subsetAdjust&amp;lt;-: getter and
    setter for the subsetAdjust slot of the object.
adjustRtime,XCMSnExp,PeakGroupsParam:
performs retention time correction based on the alignment of peak groups
(features) found in all/most samples. The correction function identified
on these peak groups is applied to the retention time of all spectra in
the object, i.e. retention times of all spectra, also MS level &amp;gt; 1 are
adjusted.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xcms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.17.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/xcms.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/LC-MS-feature-grouping.html">Compounding (grouping) of LC-MS features</a>
    </li>
    <li>
      <a href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/sneumann/xcms/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Retention time correction based on alignment of house keeping peak
groups</h1>
    <small class="dont-index">Source: <a href="https://github.com/sneumann/xcms/blob/HEAD/R/DataClasses.R" class="external-link"><code>R/DataClasses.R</code></a>, <a href="https://github.com/sneumann/xcms/blob/HEAD/R/functions-Params.R" class="external-link"><code>R/functions-Params.R</code></a>, <a href="https://github.com/sneumann/xcms/blob/HEAD/R/functions-XCMSnExp.R" class="external-link"><code>R/functions-XCMSnExp.R</code></a>, and 2 more</small>
    <div class="hidden name"><code>adjustRtime-peakGroups.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This method performs retention time adjustment based on the
alignment of chromatographic peak groups present in all/most samples
(hence corresponding to house keeping compounds). First the retention
time deviation of these peak groups is described by fitting either a
polynomial (<code>smooth = "loess"</code>) or a linear (
<code>smooth = "linear"</code>) model to the data points. These models are
subsequently used to adjust the retention time of each spectrum in
each sample.</p>
<p>It is also possible to exclude certain samples within an experiment from
the estimation of the alignment models. The parameter <code>subset</code>
allows to define the indices of samples within <code>object</code> that should
be aligned. Samples not part of this <code>subset</code> are left out in the
estimation of the alignment models, but their retention times are
subsequently adjusted based on the alignment results of the closest sample
in <code>subset</code> (close in terms of position within the <code>object</code>).
Alignment could thus be performed on only <em>real</em> samples leaving out
e.g. blanks, which are then in turn adjusted based on the closest real
sample. Here it is up to the user to ensure that the samples within
<code>object</code> are ordered correctly (e.g. by injection index).</p>
<p>How the non-subset samples are adjusted bases also on the parameter
<code>subsetAdjust</code>: with <code>subsetAdjust = "previous"</code>, each non-subset
sample is adjusted based on the closest previous subset sample which results
in most cases with adjusted retention times of the non-subset sample being
identical to the subset sample on which the adjustment bases. The second,
default, option is to use <code>subsetAdjust = "average"</code> in which case
each non subset sample is adjusted based on the average retention time
adjustment from the previous and following subset sample. For the average
a weighted mean is used with weights being the inverse of the distance of
the non-subset sample to the subset samples used for alignment.</p>
<p>See also section <em>Alignment of experiments including blanks</em> in the
<em>xcms</em> vignette for an example.</p>
<p>The <code>PeakGroupsParam</code> class allows to specify all
    settings for the retention time adjustment based on <em>house keeping</em>
    peak groups present in most samples.
    Instances should be created with the <code>PeakGroupsParam</code> constructor.</p>
<p><code>adjustRtimePeakGroups</code> returns the features (peak groups)
which would, depending on the provided <code>PeakGroupsParam</code>, be
selected for alignment/retention time correction.</p>
<p><code>minFraction</code>,<code>minFraction&lt;-</code>: getter and setter
    for the <code>minFraction</code> slot of the object.</p>
<p><code>extraPeaks</code>,<code>extraPeaks&lt;-</code>: getter and setter
    for the <code>extraPeaks</code> slot of the object.</p>
<p><code>smooth</code>,<code>smooth&lt;-</code>: getter and setter
    for the <code>smooth</code> slot of the object.</p>
<p><code>span</code>,<code>span&lt;-</code>: getter and setter
    for the <code>span</code> slot of the object.</p>
<p><code>family</code>,<code>family&lt;-</code>: getter and setter
    for the <code>family</code> slot of the object.</p>
<p><code>peakGroupsMatrix</code>,<code>peakGroupsMatrix&lt;-</code>: getter and
    setter for the <code>peakGroupsMatrix</code> slot of the object.</p>
<p><code>subset</code>,<code>subset&lt;-</code>: getter and
    setter for the <code>subset</code> slot of the object.</p>
<p><code>subsetAdjust</code>,<code>subsetAdjust&lt;-</code>: getter and
    setter for the <code>subsetAdjust</code> slot of the object.</p>
<p><code>adjustRtime,XCMSnExp,PeakGroupsParam</code>:
performs retention time correction based on the alignment of peak groups
(features) found in all/most samples. The correction function identified
on these peak groups is applied to the retention time of all spectra in
the object, i.e. retention times of all spectra, also MS level &gt; 1 are
adjusted.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">PeakGroupsParam</span><span class="op">(</span>
  minFraction <span class="op">=</span> <span class="fl">0.9</span>,
  extraPeaks <span class="op">=</span> <span class="fl">1</span>,
  smooth <span class="op">=</span> <span class="st">"loess"</span>,
  span <span class="op">=</span> <span class="fl">0.2</span>,
  family <span class="op">=</span> <span class="st">"gaussian"</span>,
  peakGroupsMatrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
  subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,
  subsetAdjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"average"</span>, <span class="st">"previous"</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu">adjustRtimePeakGroups</span><span class="op">(</span><span class="va">object</span>, param <span class="op">=</span> <span class="fu">PeakGroupsParam</span><span class="op">(</span><span class="op">)</span>, msLevel <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu"><a href="groupChromPeaks-density.html">minFraction</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu"><a href="groupChromPeaks-density.html">minFraction</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">extraPeaks</span><span class="op">(</span><span class="va">object</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">extraPeaks</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">smooth</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">smooth</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">span</span><span class="op">(</span><span class="va">object</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">span</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">family</span><span class="op">(</span><span class="va">object</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">family</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">peakGroupsMatrix</span><span class="op">(</span><span class="va">object</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">peakGroupsMatrix</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">subset</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">subset</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">subsetAdjust</span><span class="op">(</span><span class="va">object</span><span class="op">)</span>

<span class="co"># S4 method for PeakGroupsParam</span>
<span class="fu">subsetAdjust</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span>

<span class="co"># S4 method for XCMSnExp,PeakGroupsParam</span>
<span class="fu"><a href="adjustRtime.html">adjustRtime</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, msLevel <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>minFraction</dt>
<dd><p><code>numeric(1)</code> between 0 and 1 defining the minimum
required fraction of samples in which peaks for the peak group were
identified. Peak groups passing this criteria will aligned across
samples and retention times of individual spectra will be adjusted
based on this alignment. For <code>minFraction = 1</code> the peak group
has to contain peaks in all samples of the experiment. Note that if
<code>subset</code> is provided, the specified fraction is relative to the
defined subset of samples and not to the total number of samples within
the experiment (i.e. a peak has to be present in the specified
proportion of subset samples).</p></dd>
<dt>extraPeaks</dt>
<dd><p><code>numeric(1)</code> defining the maximal number of
additional peaks for all samples to be assigned to a peak group (i.e.
feature) for retention time correction. For a data set with 6 samples,
<code>extraPeaks = 1</code> uses all peak groups with a total peak count
<code>&lt;= 6 + 1</code>. The total peak count is the total number of peaks being
assigned to a peak group and considers also multiple peaks within a
sample being assigned to the group.</p></dd>
<dt>smooth</dt>
<dd><p>character defining the function to be used, to interpolate
corrected retention times for all peak groups. Either <code>"loess"</code> or
<code>"linear"</code>.</p></dd>
<dt>span</dt>
<dd><p><code>numeric(1)</code> defining the degree of smoothing (if
<code>smooth = "loess"</code>). This parameter is passed to the internal call
to <code><a href="https://rdrr.io/r/stats/loess.html" class="external-link">loess</a></code>.</p></dd>
<dt>family</dt>
<dd><p>character defining the method to be used for loess smoothing.
Allowed values are <code>"gaussian"</code> and <code>"symmetric"</code>.See
<code><a href="https://rdrr.io/r/stats/loess.html" class="external-link">loess</a></code> for more information.</p></dd>
<dt>peakGroupsMatrix</dt>
<dd><p>optional <code>matrix</code> of (raw) retention times for
the peak groups on which the alignment should be performed. Each column
represents a sample, each row a feature/peak group. Such a matrix is
for example returned by the <code>adjustRtimePeakGroups</code> method.</p></dd>
<dt>subset</dt>
<dd><p><code>integer</code> with the indices of samples within the
experiment on which the alignment models should be estimated. Samples
not part of the subset are adjusted based on the closest subset sample.
See description above for more details.</p></dd>
<dt>subsetAdjust</dt>
<dd><p><code>character</code> specifying the method with which
non-subset samples should be adjusted. Supported options are
<code>"previous"</code> and <code>"average"</code> (default). See description above
for more information.</p></dd>
<dt>object</dt>
<dd><p>For <code>adjustRtime</code>: an <code><a href="XCMSnExp-class.html">XCMSnExp</a></code> object
    containing the results from a previous chromatographic peak detection
    (see <code><a href="chromatographic-peak-detection.html">findChromPeaks</a></code>) and alignment analysis (see
    <code><a href="groupChromPeaks.html">groupChromPeaks</a></code>).</p>
<p>For all other methods: a <code>PeakGroupsParam</code> object.</p></dd>
<dt>param</dt>
<dd><p>A <code>PeakGroupsParam</code> object containing all settings for
the retention time correction method..</p></dd>
<dt>msLevel</dt>
<dd><p><code>integer(1)</code> specifying the MS level. Currently only MS
level 1 is supported.</p></dd>
<dt>value</dt>
<dd><p>The value for the slot.</p></dd>
<dt>x</dt>
<dd><p>a <code>PeakGroupsParam</code> object.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The <code>PeakGroupsParam</code> function returns a
<code>PeakGroupsParam</code> class instance with all of the settings
    specified for retention time adjustment based on <em>house keeping</em>    features/peak groups.
For <code>adjustRtimePeakGroups</code>: a <code>matrix</code>, rows being
features, columns samples, of retention times. The features are ordered
by the median retention time across columns.
For <code>adjustRtime</code>: a <code><a href="XCMSnExp-class.html">XCMSnExp</a></code> object with the
results of the retention time adjustment step. These can be accessed
with the <code><a href="XCMSnExp-class.html">adjustedRtime</a></code> method. Retention time correction
does also adjust the retention time of the identified chromatographic
peaks (accessed <em>via</em><code><a href="XCMSnExp-class.html">chromPeaks</a></code>. Note that retention
time correction drops all previous alignment results from the result
object.</p>
    </div>
    <div id="slots">
    <h2>Slots</h2>
    

<dl><dt><code>minFraction,extraPeaks,smooth,span,family,peakGroupsMatrix,subset,subsetAdjust</code></dt>
<dd><p>See corresponding parameter above.</p></dd>


</dl></div>
    <div id="note">
    <h2>Note</h2>
    <p>These methods and classes are part of the updated and modernized
<code>xcms</code> user interface which will eventually replace the
<code><a href="group-methods.html">group</a></code> methods. All of the settings to the alignment
algorithm can be passed with a <code>PeakGroupsParam</code> object.</p>
<p>The matrix with the (raw) retention times of the peak groups used
in the alignment is added to the <code>peakGroupsMatrix</code> slot of the
<code>PeakGroupsParam</code> object that is stored into the corresponding
<em>process history step</em> (see <code><a href="XCMSnExp-class.html">processHistory</a></code> for how
to access the process history).</p>
<p><code>adjustRtimePeakGroups</code> is supposed to be called <em>before</em> the
sample alignment, but after a correspondence (peak grouping).</p>
<p>This method requires that a correspondence analysis has been performed
on the data, i.e. that grouped chromatographic peaks/features are present
(see <code><a href="groupChromPeaks.html">groupChromPeaks</a></code> for details).</p>
<p>Calling <code>adjustRtime</code> on an <code>XCMSnExp</code> object will cause all
peak grouping (correspondence) results and any previous retention time
adjustments to be dropped.
In some instances, the <code>adjustRtime,XCMSnExp,PeakGroupsParam</code>
re-adjusts adjusted retention times to ensure them being in the same
order than the raw (original) retention times.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Colin A. Smith, Elizabeth J. Want, Grace O'Maille, Ruben Abagyan and
Gary Siuzdak. "XCMS: Processing Mass Spectrometry Data for Metabolite
Profiling Using Nonlinear Peak Alignment, Matching, and Identification"
<em>Anal. Chem.</em> 2006, 78:779-787.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>The <code><a href="do_adjustRtime_peakGroups.html">do_adjustRtime_peakGroups</a></code> core
    API function and <code><a href="retcor.peakgroups-methods.html">retcor.peakgroups</a></code> for the old user
    interface.
    <code><a href="plotAdjustedRtime.html">plotAdjustedRtime</a></code> for visualization of alignment results.</p>
<p><code><a href="XCMSnExp-class.html">XCMSnExp</a></code> for the object containing the results of
    the alignment.</p>
<p>Other retention time correction methods: 
<code><a href="adjustRtime-obiwarp.html">adjustRtime-obiwarp</a></code>,
<code><a href="adjustRtime.html">adjustRtime</a>()</code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Colin Smith, Johannes Rainer</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## Load a test data set with detected peaks</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">faahko_sub</span><span class="op">)</span></span>
<span class="r-in"><span class="co">## Update the path to the files for the local system</span></span>
<span class="r-in"><span class="fu"><a href="dirname.html">dirname</a></span><span class="op">(</span><span class="va">faahko_sub</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"cdf/KO"</span>, package <span class="op">=</span> <span class="st">"faahKO"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">faahko_sub</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Disable parallel processing for this example</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          mz mzmin mzmax       rt    rtmin    rtmax       into       intb   maxo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP001 453.2 453.2 453.2 2506.073 2501.378 2527.982  1007409.0  1007380.8  38152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP002 302.0 302.0 302.0 2617.185 2595.275 2640.659   687146.6   671297.8  30552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP003 344.0 344.0 344.0 2679.783 2646.919 2709.517  5210015.9  5135916.9 152320</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP004 430.1 430.1 430.1 2681.348 2639.094 2712.647  2395840.3  2299899.6  65752</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP005 366.0 366.0 366.0 2679.783 2642.224 2718.907  3365174.0  3279468.3  79928</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP006 343.0 343.0 343.0 2678.218 2637.529 2712.647 24147443.2 23703761.7 672064</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          sn sample</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP001 38151      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP002    46      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP003    68      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP004    42      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP005    49      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP006    87      1</span>
<span class="r-in"><span class="co">## The number of peaks identified per sample:</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[</span>, <span class="st">"sample"</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   2   3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  87 100  61 </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Performing the peak grouping using the "peak density" method.</span></span>
<span class="r-in"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="groupChromPeaks-density.html">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="groupChromPeaks.html">groupChromPeaks</a></span><span class="op">(</span><span class="va">res</span>, param <span class="op">=</span> <span class="va">p</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Processing 2572 mz slices ... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> OK</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Perform the retention time adjustment using peak groups found in both</span></span>
<span class="r-in"><span class="co">## files.</span></span>
<span class="r-in"><span class="va">fgp</span> <span class="op">&lt;-</span> <span class="fu">PeakGroupsParam</span><span class="op">(</span>minFraction <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Before running the alignment we can evaluate which features (peak groups)</span></span>
<span class="r-in"><span class="co">## would be used based on the specified parameters.</span></span>
<span class="r-in"><span class="va">pkGrps</span> <span class="op">&lt;-</span> <span class="fu">adjustRtimePeakGroups</span><span class="op">(</span><span class="va">res</span>, param <span class="op">=</span> <span class="va">fgp</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## We can also plot these to evaluate if the peak groups span a large portion</span></span>
<span class="r-in"><span class="co">## of the retention time range.</span></span>
<span class="r-in"><span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/plot-methods.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pkGrps</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pkGrps</span><span class="op">)</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"rt"</span>, ylab <span class="op">=</span> <span class="st">""</span>, yaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pkGrps</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pkGrps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">pkGrps</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, x1 <span class="op">=</span> <span class="va">pkGrps</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span class="r-in">    y0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pkGrps</span><span class="op">)</span><span class="op">)</span>, y1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pkGrps</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span>side <span class="op">=</span> <span class="fl">2</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">pkGrps</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-plt img"><img src="adjustRtime-peakGroups-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Next we perform the alignment.</span></span>
<span class="r-in"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="adjustRtime.html">adjustRtime</a></span><span class="op">(</span><span class="va">res</span>, param <span class="op">=</span> <span class="va">fgp</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Performing retention time correction using 19 peak groups.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Span too small for 'loess' and the available number of peak groups, resetting to 0.21</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Adjusted retention times had to be re-adjusted for some files to ensure them being in the same order than the raw retention times. A call to 'dropAdjustedRtime' might thus fail to restore retention times of chromatographic peaks to their original values. Eventually consider to increase the value of the 'span' parameter.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Applying retention time adjustment to the identified chromatographic peaks ... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> OK</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Any grouping information was dropped</span></span>
<span class="r-in"><span class="fu"><a href="XCMSnExp-class.html">hasFeatures</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Plot the raw against the adjusted retention times.</span></span>
<span class="r-in"><span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/plot-methods.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">res</span>, adjusted <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span class="r-in">    <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">16</span>, cex <span class="op">=</span> <span class="fl">0.25</span>, col <span class="op">=</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">fromFile</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-plt img"><img src="adjustRtime-peakGroups-2.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Adjusterd retention times can be accessed using</span></span>
<span class="r-in"><span class="co">## rtime(object, adjusted = TRUE) and adjustedRtime</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>, <span class="fu"><a href="XCMSnExp-class.html">adjustedRtime</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## To extract the retention times grouped by sample/file:</span></span>
<span class="r-in"><span class="va">rts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/Spectrum-class.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">res</span>, bySample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Steffen Neumann.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

